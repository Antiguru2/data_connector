# Data Connector

## Общее описание
Data Connector - это Django-приложение, предоставляющее универсальный API интерфейс для работы с любыми моделями Django. Приложение позволяет получать и обрабатывать данные в двух форматах: REST (dict) и FORM (list).

## Основные возможности
1. **Универсальный API Endpoint**
   - Доступ к любой модели через `/data_connector/super-api/<natural_key>/`
   - Поддержка всех HTTP методов (GET, POST, PUT, PATCH, DELETE)
   - Гибкая система фильтрации данных
   - Поддержка кастомных сериализаторов через параметр `serializer_name`
   - Возможность указания типа данных через параметр `data_type`

2. **Форматы данных**
   - **REST формат** (dict)
     ```python
     {
         "field_name": "value",
         "nested_field": {
             "sub_field": "value"
         }
     }
     ```
   - **FORM формат** (list)
     ```python
     [
         {
             "name": "field_name",
             "value": "field_value",
             "verbose_name": "Человекочитаемое имя"
         },
         {
             "name": "nested_field",
             "value": [
                 {
                     "name": "sub_field",
                     "value": "value"
                 }
             ]
         }
     ]
     ```

3. **Комбинирование форматов**
   - Возможность преобразования между форматами
   - Гибкая настройка правил преобразования
   - Поддержка вложенных структур данных

## Требования
- Django 4.2+
- Python 3.10+
- DRF (Django REST Framework)
- Поддержка JSON полей в базе данных

## API Endpoints

### Super API
Основной endpoint для работы с моделями:

```
GET /data_connector/super-api/<natural_key>/<obj_id>/<data_type>/<serializer_name>/ - получение объекта с использованием кастомного сериализатора

OPTIONS /data_connector/super-api/<natural_key>/<serializer_name>/ - получение структуры сериализатора с пустыми значениями
```

### Структура URL
URL имеет жесткую структуру, где все параметры должны быть указаны в определенном порядке:
- `<natural_key>` - натуральный ключ модели (например, "app_label.model_name" или "app_label__model_name")
- `<obj_id>` - идентификатор объекта (int)
- `<data_type>` - тип данных ("rest" или "form")
- `<serializer_name>` - имя кастомного сериализатора

Если какой-то из параметров не нужен, можно использовать специальные значения:
- Для строковых параметров (`data_type`, `serializer_name`): `'none'`
- Для числовых параметров (`obj_id`): `0`

Примеры:
```
# Получение списка объектов с кастомным сериализатором
/data_connector/super-api/data_connector__maintestmodel/0/none/custom_serializer/

# Получение конкретного объекта в REST формате
/data_connector/super-api/data_connector__maintestmodel/123/rest/

# Получение структуры сериализатора
/data_connector/super-api/data_connector__maintestmodel/
```

### Параметры запроса
- `natural_key` - натуральный ключ модели (например, "app_label.model_name")
- `obj_id` - идентификатор объекта
- `data_type` - тип данных ("rest" или "form")
- `serializer_name` - имя кастомного сериализатора

## Текущее состояние разработки

### Универсальный сериализатор
- **REST формат**
  - GET: готово, тесты 50%
  - POST: 80%, тесты 0%
  - OPTIONS: 50% (только внутренний сырой код), тесты 0%

- **FORM формат**
  - GET: 50%, тесты 0%

### Главная задача
Реализация метода `.options` в API для получения структуры сериализатора с пустыми значениями:
- Разработка метода `.options` в `SuperApiView`
- Реализация метода `get_empty_structure` в `DataConnectorMixin`
- Обновление документации API
- Написание тестов для нового функционала

Метод `.options` должен возвращать структуру сериализатора в формате:

**REST формат**
```json
{
    "status": "ok",
    "message": "",
    "data": {
        "field1": null,
        "field2": null,
        "nested_field": {
            "sub_field1": null,
            "sub_field2": null
        }
    }
}
```

- **FORM формат**
```json
?
```

Это позволит:
- Предварительно просматривать структуру данных
- Создавать формы на фронтенде
- Документировать API
- Тестировать структуру данных

## Детальный план реализации

### 1. Модульная архитектура (2 недели)
- [x] Разбор `SerializerField` на миксины
- [x] Разбор `DataConnector` на абстрактные модели
- [x] Создание базовых компонентов
- [ ] Тестирование модульности

### 2. Обработка REST формата (2 недели)
- [x] Реализация GET метода
- [ ] Завершение POST метода
- [ ] Завершение OPTIONS метода
- [ ] Написание тестов

### 3. Обработка FORM формата (2 недели)
- [ ] Завершение GET метода
- [ ] Реализация POST метода
- [ ] Реализация OPTIONS метода
- [ ] Написание тестов

### 4. Оптимизация и улучшения (2 недели)
- [ ] Кэширование результатов
- [ ] Оптимизация запросов к БД
- [ ] Добавление пагинации
- [ ] Улучшение обработки ошибок
- [ ] Расширение документации

### 5. Тестирование и отладка (1 неделя)
- [ ] Написание unit-тестов
- [ ] Написание интеграционных тестов
- [ ] Тестирование производительности
- [ ] Исправление багов

## Использование
1. Подключите приложение в `INSTALLED_APPS`
2. Добавьте URL-маршруты в `urls.py`
3. Настройте аутентификацию и права доступа
4. Используйте API endpoint для работы с моделями

## Безопасность
- Все API endpoints требуют аутентификации
- Настраиваемые права доступа для каждой операции
- Валидация входящих данных
- Защита от CSRF атак

## Архитектура
![карта моделей](project_models.png)

## Изменения
- Добавлен файл `local_router.py` для подключения REST роутеров
- Реализован новый класс `SuperApiView` с расширенной функциональностью
- Обновлена структура URL-маршрутов
- Добавлена поддержка кастомных сериализаторов
- Реализована гибкая система фильтрации данных